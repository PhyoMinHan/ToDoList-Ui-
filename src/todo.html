<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todo List</title>
  <link rel="stylesheet" href="../output.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body class="h-screen flex items-center justify-center" style="background-color: #8282ff;">
  <section class="w-full max-w-lg p-4">
    <div class="bg-white p-6 rounded-lg shadow-lg">
      <div class="mb-4">
        <input type="text" placeholder="Add A New Task"
          class="w-full p-2 border border-indigo-500 rounded outline-none bg-green-50" id="taskInput">
      </div>
      <div class="flex items-center justify-between mb-4">
        <div class="flex space-x-2">
          <span class="cursor-pointer text-indigo-500 font-bold underline active" data-filter="all">All</span>
          <span class="cursor-pointer text-gray-700 hover:text-indigo-500" data-filter="pending">Pending</span>
          <span class="cursor-pointer text-gray-700 hover:text-indigo-500" data-filter="completed">Completed</span>
        </div>
        <button
          class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 focus:outline-none focus:ring focus:ring-indigo-300"
          id="clearButton">
          Clear
        </button>
      </div>
      <hr class="mb-4">
      <div>
        <ul class="space-y-3 todos-list max-h-80 overflow-y-auto pr-4 mt-2"></ul>
      </div>
    </div>
  </section>

  <!-- Custom Confirmation Modal for Task Deletion -->
  <div id="confirmModal" class="fixed inset-0 flex justify-center items-center bg-black bg-opacity-50"
    style="display: none;">
    <div class="bg-white p-6 rounded-lg shadow-lg w-96 text-center">
      <p class="mb-4 text-lg text-red-600 font-bold">Are you sure you want to delete this task?</p>
      <div class="flex justify-center space-x-4">
        <button id="confirmDelete" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Yes</button>
        <button id="cancelDelete" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">No</button>
      </div>
    </div>
  </div>

  <!-- Custom Confirmation Modal for Clearing All Tasks -->
  <div id="clearConfirmModal" class="fixed inset-0 flex justify-center items-center bg-black bg-opacity-50"
    style="display: none;">
    <div class="bg-white p-6 rounded-lg shadow-lg w-96 text-center">
      <p class="mb-4 text-lg text-red-600 font-bold">Are you sure you want to clear all tasks?</p>
      <div class="flex justify-center space-x-4">
        <button id="confirmClear" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Yes</button>
        <button id="cancelClear" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">No</button>
      </div>
    </div>
  </div>

  <script>
    const taskInput = document.querySelector("#taskInput");
    const todosList = document.querySelector(".todos-list");
    const filterButtons = document.querySelectorAll("span[data-filter]");
    const clearButton = document.querySelector("#clearButton");

    let todos = JSON.parse(localStorage.getItem("todoAppTasks")) || [];
    let deleteIndex = null;

    // Render tasks based on filter
    function renderTodos(filter = "all") {
      todosList.innerHTML = "";

      // Filter tasks
      const filteredTodos = todos.filter((todo) => {
        if (filter === "completed" && todo.status !== "completed") return false;
        if (filter === "pending" && todo.status !== "pending") return false;
        return true;
      });

      // If no tasks are found, display a message
      if (filteredTodos.length === 0) {
        const noTasksMessage = document.createElement("li");
        noTasksMessage.className = "text-center text-gray-500";
        noTasksMessage.textContent = "No tasks to display";
        todosList.appendChild(noTasksMessage);
        return;
      }

      // Render filtered tasks
      filteredTodos.forEach((todo, index) => {
        const li = document.createElement("li");
        li.className = "flex justify-between items-center py-2 border-b border-indigo-500";
        li.innerHTML = `
          <div class="flex items-center w-[80%] space-x-2">
            <input type="checkbox" ${todo.status === "completed" ? "checked" : ""} data-index="${index}" class="h-4 w-4">
            <span class="todo-txt ${todo.status === "completed" ? "line-through text-gray-500" : ""} w-full break-words">${todo.task}</span>
          </div>
          <div class="icon-container space-x-2 flex items-center ml-4">
            <i class="fa-solid fa-pen-to-square text-indigo-500 cursor-pointer edit-ic" data-index="${index}"></i>
            <i class="fa-solid fa-trash text-red-500 cursor-pointer delete-ic" data-index="${index}"></i>
          </div>
        `;
        todosList.appendChild(li);
      });
    }

    // Add or edit a task
    taskInput.addEventListener("keyup", (event) => {
      const inputText = taskInput.value.trim();
      const editIndex = taskInput.dataset.editIndex;

      if (event.key === "Enter" && inputText) {
        if (editIndex !== undefined) {
          todos[editIndex].task = inputText;
          delete taskInput.dataset.editIndex;
        } else {
          todos.push({ task: inputText, status: "pending" });
        }

        localStorage.setItem("todoAppTasks", JSON.stringify(todos));
        taskInput.value = "";
        renderTodos(document.querySelector("span.active").dataset.filter);
      }
    });

    // Toggle task status
    todosList.addEventListener("change", (event) => {
      if (event.target.type === "checkbox") {
        const index = event.target.dataset.index;
        todos[index].status = event.target.checked ? "completed" : "pending";
        localStorage.setItem("todoAppTasks", JSON.stringify(todos));
        renderTodos(document.querySelector("span.active").dataset.filter);
      }
    });

    // Edit a task
    todosList.addEventListener("click", (event) => {
      if (event.target.classList.contains("edit-ic")) {
        const index = event.target.dataset.index;
        taskInput.value = todos[index].task;
        taskInput.focus();
        taskInput.dataset.editIndex = index;

        // Disable checkbox and hide delete icon while editing
        const taskItem = event.target.closest("li");
        taskItem.querySelector("input[type='checkbox']").disabled = true; // Disable checkbox
        taskItem.querySelector(".delete-ic").style.display = "none"; // Hide delete icon
      }
    });

    // Reset checkbox and delete icon after editing
    taskInput.addEventListener("blur", () => {
      const editIndex = taskInput.dataset.editIndex;
      if (editIndex !== undefined) {
        const taskItem = todosList.children[editIndex];
        taskItem.querySelector("input[type='checkbox']").disabled = false; // Enable checkbox
        taskItem.querySelector(".delete-ic").style.display = "inline"; // Show delete icon

        taskInput.value = "";
        delete taskInput.dataset.editIndex;
        renderTodos(document.querySelector("span.active").dataset.filter);
      }
    });

    // Delete a task
    todosList.addEventListener("click", (event) => {
      if (event.target.classList.contains("delete-ic")) {
        deleteIndex = event.target.dataset.index;
        const confirmModal = document.getElementById("confirmModal");
        confirmModal.style.display = "flex"; // Show modal
      }
    });

    // Handle confirmation modal actions for deleting
    document.getElementById("confirmDelete").addEventListener("click", () => {
      todos.splice(deleteIndex, 1);
      localStorage.setItem("todoAppTasks", JSON.stringify(todos));
      renderTodos(document.querySelector("span.active").dataset.filter);

      // Hide the modal
      const confirmModal = document.getElementById("confirmModal");
      confirmModal.style.display = "none"; // Hide modal
    });

    document.getElementById("cancelDelete").addEventListener("click", () => {
      const confirmModal = document.getElementById("confirmModal");
      confirmModal.style.display = "none"; // Hide modal
    });

    // Handle confirmation modal actions for clearing all tasks
    clearButton.addEventListener("click", () => {
      const clearConfirmModal = document.getElementById("clearConfirmModal");
      clearConfirmModal.style.display = "flex"; // Show modal
    });

    document.getElementById("confirmClear").addEventListener("click", () => {
      todos = [];
      localStorage.setItem("todoAppTasks", JSON.stringify(todos));
      renderTodos("all");

      // Hide the modal
      const clearConfirmModal = document.getElementById("clearConfirmModal");
      clearConfirmModal.style.display = "none"; // Hide modal
    });

    document.getElementById("cancelClear").addEventListener("click", () => {
      const clearConfirmModal = document.getElementById("clearConfirmModal");
      clearConfirmModal.style.display = "none"; // Hide modal
    });

    // Filter tasks
    filterButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        document.querySelector("span.active").classList.remove("active", "text-indigo-500", "font-bold", "underline");
        btn.classList.add("active", "text-indigo-500", "font-bold", "underline");
        renderTodos(btn.dataset.filter);
      });
    });

    // Initial render
    renderTodos("all");
  </script>
</body>

</html>
